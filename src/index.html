<!DOCTYPE html>
<html>
<head>
  <title></title>
</head>
<style type="text/css">
  * {
    box-sizing: border-box;
  }
  
  .board {
    margin: auto;
  }
  
  .row {
    display: block;
    text-align: center;
    height: calc(800px / 40);
  }

  .tile {
    display: inline-block;;
    width: calc(800px / 40);
    height: calc(800px / 40);
    background: #CFD6E6;
    border: 1px solid white;
    margin: 0 0 -2px;
    transition: background .2s ease-in-out;
  }

  .tile.live {
    background: #658FFF;
  }

  button {
    position: fixed;
    top: 10px;
    right: 10px;
  }

</style>
<body>
<div class="board"></div>
</body>
<script type="text/javascript">


function makeBoard(rows, cols) {

  const board = document.querySelector('.board')
  const tiles = []

  for (var i = 0; i < rows; i++) {
    const row = document.createElement('div');
    row.classList.add('row')

    for (let j = 0; j < cols; j++) {
      const tile = document.createElement('div')
      tile.classList.add('tile')
      row.appendChild(tile)
    }

    tiles.push(row)
  }

  for (const i of tiles) {
    board.appendChild(i)
  }
}

makeBoard(40, 40)

function getTiles() {
  console.log('getTiles');
  const len = document.querySelector('.row').childNodes.length
  const tiles = [...document.querySelectorAll('.tile')]
  const rows = [...document.querySelectorAll('.row')]
  const result = []

  for (const row of rows){
    const rowArr = []

    for (const tile of row.childNodes){
      rowArr.push(tile)
    }

    result.push(rowArr)
  }

  return result
}

function findSiblings(arr, i, j) {
  const len = arr[0].length
  const siblings = []

  // top left
  if (i - 1 >= 0 && j - 1 >= 0) {
    siblings.push(arr[i - 1][j - 1])
  }

  // top middle 
  if (i - 1 >= 0) {
    siblings.push(arr[i - 1][j])
  }

  // top right 
  if (i - 1 >= 0 && j + 1 < len) {
    siblings.push(arr[i - 1][j + 1])
  }

  // middle left
  if (j - 1 >= 0) {
    siblings.push(arr[i][j - 1])
  }

  // middle right 
  if (j + 1 < len) {
    siblings.push(arr[i][j + 1])
  }

  // bottom left 
  if (i + 1 < len && j - 1 >= 0) {
    siblings.push(arr[i + 1][j - 1])
  }

  // bottom middle 
  if (i + 1 < len) {
    siblings.push(arr[i + 1][j])
  }

  // bottom right 
  if (i + 1 < len && j + 1 < len) {
    siblings.push(arr[i + 1][j + 1])
  }

  return siblings
}


function runGame() {
  const arr = getTiles()
  const liveTiles = document.querySelectorAll('.live').length
  
  if (liveTiles === 0) {
    console.log('game over');
    return false
  } 

  for (const [i, row] of arr.entries()) {
    for (const [j, tile] of row.entries()) {

      const siblings = findSiblings(arr, i, j)
      const liveCount = siblings.filter(i => i.classList.contains('live')).length

      // live tiles 
      if (tile.classList.contains('live')) {
        
        if (liveCount === 2 || liveCount === 3){
          // live cell has two or three live 
          // neighbors, it continues living
          // console.log('continues living');
        } else if (liveCount > 3 || liveCount < 2) {
          // live cell has less than two, or more 
          // than three live neighbors, it dies
          tile.classList.remove('live')
        }       
      // dead tiles
      } else {  
        if (liveCount === 3) {
          // dead cell has exactly three 
          // live neighbors, it comes to life
          tile.classList.add('live')
        }
      }
    }
  }
}

function killRandom() {
  const arr = getTiles()

  for (const [i, row] of arr.entries()) {
    for (const [j, tile] of row.entries()) {
      const r = Math.floor(Math.random()*arr[0].length)
      if (i === r || j === r) {
        tile.classList.add('live')
      }
    }
  }
}

killRandom()
killRandom()
killRandom()

const button = document.createElement('button')
button.textContent = "click"
button.addEventListener('click', () => {
  runGame()
})

document.body.appendChild(button)






</script>
</html>
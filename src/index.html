<!DOCTYPE html>
<html>
<head>
  <title></title>
</head>
<body>
  <div class="wrap">
    <input type="text" placeholder="Search for cards">
    <ul></ul>  
  </div>
</body>
<script type="text/javascript">

function foundEl(first, second) {
  return first.some(i => second.indexOf(i) >= 0)
}

class Card {
  constructor(code, src, text){
    this.code = code;
    this.src = src;
    this.text = text;
  }
}

class SearchDeck {
  constructor(){
    this.getDeck()
    this.setupEvents()
  }

  getDeck(){
    const deck = fetch('https://deckofcardsapi.com/api/deck/new/shuffle/?deck_count=1')
    deck.then(data => data.json()).then(data => {
      this.id = data.deck_id
      this.getCards(this.id)
    })
  }

  getCards(id){
    fetch(`https://deckofcardsapi.com/api/deck/${id}/draw/?count=52`)
      .then(res => res.json())
      .then(res => {
        this.cards = res.cards.map(i => new Card(i.code, i.image, `${i.value} OF ${i.suit}`))
        console.log(`got ${this.cards.length} cards`)
      })
  }

  setupEvents(){
    const input = document.querySelector('input')

    input.addEventListener('keyup', (e) => {
      const val = input.value.toUpperCase()
      this.handleInput(val, e)
    })
  }

  handleInput(val, e) {
    const ul = document.querySelector('ul')

    // reset auto list if there is no value
    if (val.length == 0) return ul.innerHTML = ''
    
    // make set from current letters
    const words = val.split(' ')
    
    // show only cards that contain current letters
    const filtered = []

    // show all by typing 'all'
    if (words[0] === 'ALL') {
      this.cards.forEach(i => {
        filtered.push(i)
      })
    }

    for (const i of this.cards){      

      const found = i.text.split(' ')    
      
      if (foundEl(words, found)) {        
        filtered.push(i)
      }
    }

    // add all matching cards to html list
    const template = `
      ${filtered.map(i => {
        return `<li><img src='${i.src}'/></li>`
      }).join('')}
    `
    ul.innerHTML = template  
  }

}

const deck = new SearchDeck()



</script>
</html>